# Taric API

## Overview

This API provides access to Taric XML files that have been generated by the DIT Tariff Application.

Taric files are processed in sequential order so a client system knowing the last file that was imported could retrieve the next file in sequence.

Files are indexed by date to allow the respective file(s) for a particular date (typically yesterday) to be retrieved.

For example:

**DATE**    | **FILE(S)**
---|---
02-01-2019  | 190001
03-01-2019  | 190002, 190003 
04-01-2019  | 190004
07-01-2019  | 190005

## API endpoints

### List files available by date

**/api/v1/taricdeltas/{date}**

{date} defaults to yesterday

curl -i -H "X-API-KEY: abc123" localhost:8080/api/v1/taricdeltas


curl -i -H "X-API-KEY: abc123" localhost:8080/api/v1/taricdeltas/2018-12-01

### Get specific file

**/api/v1/taricfiles/{sequenceid}**

curl -i -H "X-API-KEY: abc123" localhost:8080/api/v1/taricfiles/18004



### Upload file

POST method of the get specific file

curl --form file=@/users/dave/downloads/Taric3_files/TGB18146.xml -H "X-API-KEY: def456" localhost:8080/api/v1/taricfiles/18003


# Security mechanisms

Api key in HTTP HEADER required for authentication.

Api key for upload is separate.

Access to the API endpoints is for whitelisted IP Addresses.

Uploads are permitted from separate list of IP addresses.


# Installation

##  Environment Variables

**NAME**            | **PURPOSE**
---|---
API_ROOT            | URL prefix for serving files
TARIC_FILES_FOLDER  | Location for Taric files (defaults to /)
TARIC_FILES_INDEX   | Location of index file (defaults to /)
API_KEYS            | Comma separated list of API keys that are SHA256 encoded
WHITELIST           | Comma separated list of whitelisted source IP addresses **
APIKEYS_UPLOAD      | Same as API_KEYS above - except these are the keys authorised to upload Taric files
WHITELIST_UPLOAD    | Same as WHITELIST above - except these are the IP addresses whitelisted to upload Taric files
AWS_BUCKET_NAME     | S3 bucket storing the Taric files ***
AWS_ACCESS_KEY_ID   | S3 Access key
AWS_SECRET_ACCESS_KEY   | S3 Secret

** IP addresses can be a range such as 11.22.33.44/24

*** Storage can be S3 or local - depends on the module used in the build - either **apifile.py** _or_ **apifiles3.py**



##  Local Installation
###  virtualenv
###  requirements.txt


##  Cloudfoundry Installation
procfile and manifest are provided

Using the Cloudfoundry cli:

cf push {app-name}


# Tests

Basic test script uses curl and unix shell script.

Script checks all the conditions and response codes.

Sample environment variables provided.

# Further detail

Complete API specification is documented and available in the word document.





